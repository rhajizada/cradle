{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://cradle.dev/schema/config.json",
  "title": "Cradle Config",
  "type": "object",
  "additionalProperties": false,
  "required": ["version", "aliases"],
  "properties": {
    "version": {
      "type": "integer",
      "const": 1
    },
    "aliases": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/definitions/alias"
      }
    }
  },
  "definitions": {
    "alias": {
      "type": "object",
      "additionalProperties": false,
      "required": ["image", "run"],
      "properties": {
        "image": { "$ref": "#/definitions/image" },
        "run": { "$ref": "#/definitions/run" }
      }
    },
    "image": {
      "type": "object",
      "additionalProperties": false,
      "oneOf": [
        { "required": ["pull"], "properties": { "pull": { "$ref": "#/definitions/pull" } } },
        { "required": ["build"], "properties": { "build": { "$ref": "#/definitions/build" } } }
      ]
    },
    "pull": {
      "type": "object",
      "additionalProperties": false,
      "required": ["ref"],
      "properties": {
        "ref": { "type": "string", "minLength": 1 }
      }
    },
    "build": {
      "type": "object",
      "additionalProperties": false,
      "required": ["cwd"],
      "properties": {
        "cwd": { "type": "string", "minLength": 1 },
        "dockerfile": { "type": "string" },
        "args": { "$ref": "#/definitions/stringMap" },
        "target": { "type": "string" },
        "labels": { "$ref": "#/definitions/stringMap" },
        "pull": { "type": "boolean" },
        "no_cache": { "type": "boolean" },
        "cache_from": { "type": "array", "items": { "type": "string" } },
        "network": { "type": "string" },
        "extra_hosts": { "type": "array", "items": { "type": "string" } },
        "platforms": { "type": "array", "items": { "type": "string" } }
      }
    },
    "run": {
      "type": "object",
      "additionalProperties": false,
      "required": ["username", "uid", "gid"],
      "properties": {
        "username": { "type": "string", "minLength": 1 },
        "uid": { "type": "integer" },
        "gid": { "type": "integer" },
        "tty": { "type": "boolean" },
        "stdin_open": { "type": "boolean" },
        "attach": { "type": "boolean" },
        "auto_remove": { "type": "boolean" },
        "name": { "type": "string" },
        "hostname": { "type": "string" },
        "workdir": { "type": "string" },
        "env": { "$ref": "#/definitions/stringMap" },
        "entrypoint": { "$ref": "#/definitions/stringList" },
        "cmd": { "$ref": "#/definitions/stringList" },
        "network": { "type": "string" },
        "ports": { "$ref": "#/definitions/stringList" },
        "extra_hosts": { "$ref": "#/definitions/stringList" },
        "mounts": { "type": "array", "items": { "$ref": "#/definitions/mount" } },
        "resources": { "$ref": "#/definitions/resources" },
        "privileged": { "type": "boolean" },
        "restart": { "type": "string" },
        "platform": { "type": "string" }
      }
    },
    "mount": {
      "type": "object",
      "additionalProperties": false,
      "required": ["type", "target"],
      "properties": {
        "type": { "type": "string", "enum": ["bind", "volume", "tmpfs"] },
        "source": { "type": "string" },
        "target": { "type": "string", "minLength": 1 },
        "readonly": { "type": "boolean" }
      },
      "allOf": [
        {
          "if": { "properties": { "type": { "enum": ["bind", "volume"] } } },
          "then": { "required": ["source"] }
        }
      ]
    },
    "resources": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "cpus": { "type": "number" },
        "memory": { "type": "string" },
        "shm_size": { "type": "string" }
      }
    },
    "stringMap": {
      "type": "object",
      "additionalProperties": { "type": "string" }
    },
    "stringList": {
      "type": "array",
      "items": { "type": "string" }
    }
  }
}
